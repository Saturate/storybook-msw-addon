'use strict';

var previewApi = require('@storybook/preview-api');
var coreEvents = require('@storybook/core-events');
var msw = require('msw');

var m="storybook/msw-vite-addon",w="msw",a={SEND:`${m}/send`,UPDATE:`${m}/update`,UPDATE_RESPONSES:`${m}/update-responses`,RESET:`${m}/reset`};var O="__HandlerResponseKeySeparator__",P=e=>[e.info.method,e.info.path].join(O);var p=previewApi.addons.getChannel(),A=!0,h=!1,E=0,y=200,o={},g,C=(e,t,s)=>e[t]||s,f=e=>{if(!e||!o)return;let t=window.msw;e?.forEach(s=>{let n=o[P(s)];y=n.status;let r=s.info.method;if(typeof r!="string"){console.warn(`[MSW] Failed to retrieve the original response for the given handler. Can only retrieve original responses for handlers with a string method, RegExp is currently not supported. Offending path: ${s.info.path}`);return}let d={GET:msw.http.get,POST:msw.http.post,PUT:msw.http.put,DELETE:msw.http.delete,PATCH:msw.http.patch,HEAD:msw.http.head,OPTIONS:msw.http.options}[r];t.use(d(s.info.path,async()=>(await msw.delay(E),msw.HttpResponse.json(n.data,{status:n.status}))));});},D=(e,t)=>{let s,n,r,d=window.msw;s=t.parameters,s&&(n=C(s,w,[]));let c=previewApi.useChannel({[a.UPDATE]:({key:u,value:l})=>{u==="delay"&&(clearTimeout(g),E=l,f(r),g=setTimeout(()=>{p.emit(coreEvents.FORCE_REMOUNT,{storyId:t.id});},300)),u==="status"&&(y=l,Object.keys(o).forEach(S=>{o[S].status=l;}),f(r),p.emit(coreEvents.FORCE_REMOUNT,{storyId:t.id}));let T={delay:E,status:y,responses:o};c(a.SEND,T);},[a.UPDATE_RESPONSES]:({key:u,objectKey:l,objectValue:T})=>{if(u==="responses"){o[l].data=T;let S={delay:E,status:y,responses:o};f(r),c(a.SEND,S),p.emit(coreEvents.FORCE_REMOUNT,{storyId:t.id});}},[a.RESET]:()=>{delete window.msw.originalResponses,d.stop(),location.reload();}});return !n||!d?(c(a.SEND,{status:void 0,delay:void 0,responses:void 0}),e()):(A&&(r=n.handlers,o=n.originalResponses,f(r),c(a.SEND,{status:y,delay:E,responses:o}),p.on(coreEvents.STORY_ARGS_UPDATED,()=>{t.viewMode!=="docs"&&(delete window.msw.originalResponses,location.reload());}),p.on(coreEvents.STORY_CHANGED,()=>{delete window.msw.originalResponses,d.stop(),h=!0,location.reload();}),A=!1),h&&(h=!1,p.emit(coreEvents.FORCE_REMOUNT,{storyId:t.id})),e())};var U={decorators:[D]},W=U;

module.exports = W;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=preview.js.map